---
import PageLayout from '../../layouts/PageLayout.astro';
---

<style>
.cover-container {
  position: relative;
  display: inline-block;
}

.cover-container::after {
  content: attr(data-info);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 14px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
  margin-bottom: 8px;
  z-index: 10;
}

.cover-container:hover::after {
  opacity: 1;
}
</style>

<PageLayout
  title="Recommendations - Ramy Ghorayeb"
  description="My favorite books, mangas, music, movies, and TV shows that deserve more attention"
>
  <div class="fade-in">
    <!-- Page Title -->
    <h1 class="text-4xl md:text-5xl font-bold mb-16">Recommendations</h1>

    <!-- Recommendations Content -->
    <section class="max-w-5xl">
      <div class="prose prose-lg max-w-none">

        <!-- Current Reads Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-text);">Current Reads</h2>
          <p class="text-sm mb-6" style="color: var(--color-text-secondary);">
            Continuously updated through my RSS feed
          </p>

          <!-- Loading State -->
          <div id="books-loading" class="text-lg" style="color: var(--color-text-secondary);">
            Loading books<span id="loading-dots">.</span>
          </div>

          <!-- Error State -->
          <div id="books-error" class="hidden text-lg" style="color: var(--color-text-secondary);">
            Unable to load books. Please try again later.
          </div>

          <!-- Books List -->
          <ul id="books-container" class="hidden list-none space-y-2" style="color: var(--color-text);">
            <!-- Books will be inserted here -->
          </ul>
        </div>

        <script>
          const GOODREADS_USER_ID = '164831396';
          const RSS_URL = `https://www.goodreads.com/review/list_rss/${GOODREADS_USER_ID}?shelf=currently-reading`;

          // Animate loading dots
          let dotCount = 1;
          const dotsInterval = setInterval(() => {
            const dotsEl = document.getElementById('loading-dots');
            if (dotsEl) {
              dotCount = (dotCount % 3) + 1;
              dotsEl.textContent = '.'.repeat(dotCount);
            }
          }, 500);

          async function loadCurrentlyReading() {
            const loadingEl = document.getElementById('books-loading');
            const errorEl = document.getElementById('books-error');
            const containerEl = document.getElementById('books-container');

            try {
              // Use a CORS proxy to fetch the RSS feed
              const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(RSS_URL)}`);
              const data = await response.json();
              const xmlText = data.contents;

              // Parse XML
              const parser = new DOMParser();
              const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

              // Get all book items
              const items = xmlDoc.querySelectorAll('item');

              if (items.length === 0) {
                clearInterval(dotsInterval);
                loadingEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
                errorEl.textContent = 'No books currently reading.';
                return;
              }

              // Clear container
              while (containerEl.firstChild) {
                containerEl.removeChild(containerEl.firstChild);
              }

              // Process each book
              items.forEach(item => {
                const title = item.querySelector('title')?.textContent || 'Unknown Title';
                const link = item.querySelector('link')?.textContent || '#';
                const description = item.querySelector('description')?.textContent || '';
                const pubDate = item.querySelector('pubDate')?.textContent || '';

                // Extract author from description
                const authorMatch = description.match(/author:\s*([^<\n]+)/i);
                const author = authorMatch ? authorMatch[1].trim() : 'Unknown Author';

                // Format date added
                let dateAdded = '';
                if (pubDate) {
                  const date = new Date(pubDate);
                  dateAdded = date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                }

                // Create bullet point
                const listItem = document.createElement('li');
                listItem.className = 'text-lg';
                listItem.style.color = 'var(--color-text)';

                // Format: Author - Title (added on Date)
                const bookLink = document.createElement('a');
                bookLink.href = link;
                bookLink.target = '_blank';
                bookLink.rel = 'noopener noreferrer';
                bookLink.className = 'hover:underline';
                bookLink.style.color = 'var(--color-text)';
                bookLink.textContent = `${author} - ${title}`;

                listItem.appendChild(bookLink);

                if (dateAdded) {
                  const dateSpan = document.createElement('span');
                  dateSpan.style.color = 'var(--color-text-secondary)';
                  dateSpan.textContent = ` (added on ${dateAdded})`;
                  listItem.appendChild(dateSpan);
                }

                containerEl.appendChild(listItem);
              });

              // Show list, hide loading
              clearInterval(dotsInterval);
              loadingEl.classList.add('hidden');
              containerEl.classList.remove('hidden');

            } catch (error) {
              console.error('Error loading books:', error);
              clearInterval(dotsInterval);
              loadingEl.classList.add('hidden');
              errorEl.classList.remove('hidden');
            }
          }

          // Load books when page loads
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadCurrentlyReading);
          } else {
            loadCurrentlyReading();
          }
        </script>

        <!-- Recommendations Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-text);">Recommendations</h2>
          <p class="text-sm mb-8" style="color: var(--color-text-secondary);">
            Works that friends often overlook despite their acclaim—especially when unfamiliar with the style.
          </p>
        </div>

        <!-- Books Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Books</h2>
          <div class="grid grid-cols-5 gap-4">
            <div class="cover-container" data-info="Albert Camus - The Stranger (1942)">
              <img src="/images/recommendations/books/the-stranger.jpg" alt="The Stranger" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Chuck Palahniuk - Stranger Than Fiction (2004)">
              <img src="/images/recommendations/books/stranger-than-fiction.jpg" alt="Stranger Than Fiction" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Cizia Zykë - Oro (1997)">
              <img src="/images/recommendations/books/oro.jpg" alt="Oro" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Liu Cixin - Death's End (2010)">
              <img src="/images/recommendations/books/deaths-end.jpg" alt="Death's End" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Philip K. Dick - Ubik (1969)">
              <img src="/images/recommendations/books/ubik.jpg" alt="Ubik" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Robert L Moore & Douglas Gillette - King, Warrior, Magician, Lover (1990)">
              <img src="/images/recommendations/books/king-warrior-magician-lover.jpg" alt="King, Warrior, Magician, Lover" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Thomas Römer - The Invention of God (2015)">
              <img src="/images/recommendations/books/invention-of-god.jpg" alt="The Invention of God" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Jean-Paul Chagnollaud & Pierre Blanc - L'invention tragique du Moyen-Orient (2017)">
              <img src="/images/recommendations/books/invention-tragique-moyen-orient.jpg" alt="L'invention tragique du Moyen-Orient" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Bernard Werber - Les Thanatonautes (1994)">
              <img src="/images/recommendations/books/les-thanatonautes.jpg" alt="Les Thanatonautes" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Jack Kerouac - On the Road (1957)">
              <img src="/images/recommendations/books/on-the-road.jpg" alt="On the Road" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
          </div>
        </div>

        <!-- Mangas/Comic Books Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Mangas / Comic Books</h2>
          <div class="grid grid-cols-5 gap-4">
            <div class="cover-container" data-info="Kentaro Miura - Berserk (1989)">
              <img src="/images/recommendations/mangas/berserk.jpg" alt="Berserk" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Tom Taylor - Injustice: Gods Among Us (2013)">
              <img src="/images/recommendations/mangas/injustice.jpg" alt="Injustice: Gods Among Us" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Alan Moore - Watchmen (1987)">
              <img src="/images/recommendations/mangas/watchmen.jpg" alt="Watchmen" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Tsugumi Ohba - Death Note (2003)">
              <img src="/images/recommendations/mangas/death-note.jpg" alt="Death Note" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Yoshihiro Togashi - Hunter x Hunter (1998)">
              <img src="/images/recommendations/mangas/hunter-x-hunter.jpg" alt="Hunter x Hunter" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Takehiko Inoue - Real (1999)">
              <img src="/images/recommendations/mangas/real.jpg" alt="Real" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Toru Fujisawa - Great Teacher Onizuka (1997)">
              <img src="/images/recommendations/mangas/gto.jpg" alt="Great Teacher Onizuka" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Harold Sakuishi - Beck (1999)">
              <img src="/images/recommendations/mangas/beck.jpg" alt="Beck" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Hiroya Oku - Gantz (2000)">
              <img src="/images/recommendations/mangas/gantz.jpg" alt="Gantz" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Don Rosa - The Life and Times of Scrooge McDuck (1994)">
              <img src="/images/recommendations/mangas/scrooge-mcduck.jpg" alt="The Life and Times of Scrooge McDuck" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
          </div>
        </div>

        <!-- Music Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Music</h2>
          <div class="grid grid-cols-5 gap-4">
            <div class="cover-container" data-info="Mr Bungle - California (1999)">
              <img src="/images/recommendations/music/california.jpg" alt="California" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Swans - The Seer (2012)">
              <img src="/images/recommendations/music/the-seer.jpg" alt="The Seer" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Nirvana - MTV Unplugged in New York (1994)">
              <img src="/images/recommendations/music/mtv-unplugged.jpg" alt="MTV Unplugged" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Pink Floyd - The Dark Side of the Moon (1973)">
              <img src="/images/recommendations/music/dark-side-moon.jpg" alt="The Dark Side of the Moon" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Devin Townsend - Infinity (1998)">
              <img src="/images/recommendations/music/infinity.jpg" alt="Infinity" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="JPEGMAFIA - Veteran (2018)">
              <img src="/images/recommendations/music/veteran.jpg" alt="Veteran" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Steven Wilson - Insurgentes (2008)">
              <img src="/images/recommendations/music/insurgentes.jpg" alt="Insurgentes" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Massive Attack - Mezzanine (1998)">
              <img src="/images/recommendations/music/mezzanine.jpg" alt="Mezzanine" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Klub des Loosers - La Fin de l'Espèce (2010)">
              <img src="/images/recommendations/music/la-fin-de-lespece.jpg" alt="La Fin de l'Espèce" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Trent Reznor & Atticus Ross - The Social Network (2010)">
              <img src="/images/recommendations/music/social-network.jpg" alt="The Social Network" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
          </div>
        </div>

        <!-- Movies Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Movies</h2>
          <div class="grid grid-cols-5 gap-4">
            <div class="cover-container" data-info="Damien Chazelle - Whiplash (2014)">
              <img src="/images/recommendations/movies/whiplash.jpg" alt="Whiplash" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Sam Mendes - American Beauty (1999)">
              <img src="/images/recommendations/movies/american-beauty.jpg" alt="American Beauty" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Jan Kounen - 99 Francs (2007)">
              <img src="/images/recommendations/movies/99-francs.jpg" alt="99 Francs" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Pete Docter - Soul (2020)">
              <img src="/images/recommendations/movies/soul.jpg" alt="Soul" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Quentin Dupieux - Wrong (2012)">
              <img src="/images/recommendations/movies/wrong.jpg" alt="Wrong" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Julia Ducournau - Grave (2016)">
              <img src="/images/recommendations/movies/grave.jpg" alt="Grave" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Alejandro González Iñárritu - Birdman (2014)">
              <img src="/images/recommendations/movies/birdman.jpg" alt="Birdman" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Matt Ross - Captain Fantastic (2016)">
              <img src="/images/recommendations/movies/captain-fantastic.jpg" alt="Captain Fantastic" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Harmony Korine - Spring Breakers (2012)">
              <img src="/images/recommendations/movies/spring-breakers.jpg" alt="Spring Breakers" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Kinji Fukasaku - Battle Royale (2000)">
              <img src="/images/recommendations/movies/battle-royale.jpg" alt="Battle Royale" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
          </div>
        </div>

        <!-- TV Shows Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">TV Shows</h2>
          <div class="grid grid-cols-5 gap-4">
            <div class="cover-container" data-info="Damon Lindelof - The Leftovers (2014)">
              <img src="/images/recommendations/tv-shows/the-leftovers.jpg" alt="The Leftovers" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Christopher Cantwell - Halt and Catch Fire (2014)">
              <img src="/images/recommendations/tv-shows/halt-and-catch-fire.jpg" alt="Halt and Catch Fire" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Kyan Khojandi - Bref (2011)">
              <img src="/images/recommendations/tv-shows/bref.jpg" alt="Bref" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Dennis Kelly - Utopia (2013)">
              <img src="/images/recommendations/tv-shows/utopia.jpg" alt="Utopia" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Michael Dante DiMartino - Avatar: The Last Airbender (2005)">
              <img src="/images/recommendations/tv-shows/avatar.jpg" alt="Avatar: The Last Airbender" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Paolo Sorrentino - The Young Pope (2016)">
              <img src="/images/recommendations/tv-shows/the-young-pope.jpg" alt="The Young Pope" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Troy Wagner - Marble Hornets (2009)">
              <img src="/images/recommendations/tv-shows/marble-hornets.jpg" alt="Marble Hornets" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Dan Perrault - American Vandal (2017)">
              <img src="/images/recommendations/tv-shows/american-vandal.jpg" alt="American Vandal" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Nathan Fielder - The Rehearsal (2022)">
              <img src="/images/recommendations/tv-shows/the-rehearsal.jpg" alt="The Rehearsal" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
            <div class="cover-container" data-info="Simon Rich - Man Seeking Woman (2015)">
              <img src="/images/recommendations/tv-shows/man-seeking-woman.jpg" alt="Man Seeking Woman" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            </div>
          </div>
        </div>

      </div>
    </section>
  </div>
</PageLayout>
