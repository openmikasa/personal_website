---
import PageLayout from '../../layouts/PageLayout.astro';
---

<PageLayout
  title="Recommendations - Ramy Ghorayeb"
  description="My favorite books, mangas, music, movies, and TV shows that deserve more attention"
>
  <div class="fade-in">
    <!-- Page Title -->
    <h1 class="text-4xl md:text-5xl font-bold mb-16">Recommendations</h1>

    <!-- Recommendations Content -->
    <section class="max-w-5xl">
      <div class="prose prose-lg max-w-none">

        <!-- Current Reads Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-text);">Current Reads</h2>
          <p class="text-sm mb-6" style="color: var(--color-text-secondary);">
            Continuously updated through my RSS feed
          </p>

          <!-- Loading State -->
          <div id="books-loading" class="text-lg" style="color: var(--color-text-secondary);">
            Loading books<span id="loading-dots">.</span>
          </div>

          <!-- Error State -->
          <div id="books-error" class="hidden text-lg" style="color: var(--color-text-secondary);">
            Unable to load books. Please try again later.
          </div>

          <!-- Books List -->
          <ul id="books-container" class="hidden list-none space-y-2" style="color: var(--color-text);">
            <!-- Books will be inserted here -->
          </ul>
        </div>

        <script>
          const GOODREADS_USER_ID = '164831396';
          const RSS_URL = `https://www.goodreads.com/review/list_rss/${GOODREADS_USER_ID}?shelf=currently-reading`;

          // Animate loading dots
          let dotCount = 1;
          const dotsInterval = setInterval(() => {
            const dotsEl = document.getElementById('loading-dots');
            if (dotsEl) {
              dotCount = (dotCount % 3) + 1;
              dotsEl.textContent = '.'.repeat(dotCount);
            }
          }, 500);

          async function loadCurrentlyReading() {
            const loadingEl = document.getElementById('books-loading');
            const errorEl = document.getElementById('books-error');
            const containerEl = document.getElementById('books-container');

            try {
              // Use a CORS proxy to fetch the RSS feed
              const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(RSS_URL)}`);
              const data = await response.json();
              const xmlText = data.contents;

              // Parse XML
              const parser = new DOMParser();
              const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

              // Get all book items
              const items = xmlDoc.querySelectorAll('item');

              if (items.length === 0) {
                clearInterval(dotsInterval);
                loadingEl.classList.add('hidden');
                errorEl.classList.remove('hidden');
                errorEl.textContent = 'No books currently reading.';
                return;
              }

              // Clear container
              while (containerEl.firstChild) {
                containerEl.removeChild(containerEl.firstChild);
              }

              // Process each book
              items.forEach(item => {
                const title = item.querySelector('title')?.textContent || 'Unknown Title';
                const link = item.querySelector('link')?.textContent || '#';
                const description = item.querySelector('description')?.textContent || '';
                const pubDate = item.querySelector('pubDate')?.textContent || '';

                // Extract author from description
                const authorMatch = description.match(/author:\s*([^<\n]+)/i);
                const author = authorMatch ? authorMatch[1].trim() : 'Unknown Author';

                // Format date added
                let dateAdded = '';
                if (pubDate) {
                  const date = new Date(pubDate);
                  dateAdded = date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                }

                // Create bullet point
                const listItem = document.createElement('li');
                listItem.className = 'text-lg';
                listItem.style.color = 'var(--color-text)';

                // Format: Author - Title (added on Date)
                const bookLink = document.createElement('a');
                bookLink.href = link;
                bookLink.target = '_blank';
                bookLink.rel = 'noopener noreferrer';
                bookLink.className = 'hover:underline';
                bookLink.style.color = 'var(--color-text)';
                bookLink.textContent = `${author} - ${title}`;

                listItem.appendChild(bookLink);

                if (dateAdded) {
                  const dateSpan = document.createElement('span');
                  dateSpan.style.color = 'var(--color-text-secondary)';
                  dateSpan.textContent = ` (added on ${dateAdded})`;
                  listItem.appendChild(dateSpan);
                }

                containerEl.appendChild(listItem);
              });

              // Show list, hide loading
              clearInterval(dotsInterval);
              loadingEl.classList.add('hidden');
              containerEl.classList.remove('hidden');

            } catch (error) {
              console.error('Error loading books:', error);
              clearInterval(dotsInterval);
              loadingEl.classList.add('hidden');
              errorEl.classList.remove('hidden');
            }
          }

          // Load books when page loads
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadCurrentlyReading);
          } else {
            loadCurrentlyReading();
          }
        </script>

        <!-- Recommendations Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-text);">Recommendations</h2>
          <p class="text-sm mb-8" style="color: var(--color-text-secondary);">
            Works that friends often overlook despite their acclaim—especially when unfamiliar with the style.
          </p>
        </div>

        <!-- Books Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Books</h2>
          <div class="grid grid-cols-5 gap-4">
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1738704267i/49552.jpg" alt="The Stranger by Albert Camus" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1429328877i/3718.jpg" alt="Stranger Than Fiction by Chuck Palahniuk" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1436934349i/28676.jpg" alt="American Psycho by Bret Easton Ellis" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1327869409i/7624.jpg" alt="Lord of the Flies by William Golding" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1344463695i/1848300.jpg" alt="Oro by Cizia Zykë" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1657781256i/61439040.jpg" alt="1984 by George Orwell" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1430330507i/25451264.jpg" alt="Death's End by Liu Cixin" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1327995569i/22590.jpg" alt="Ubik by Philip K. Dick" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1387347452i/122372.jpg" alt="Les Thanatonautes by Bernard Werber" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/S/compressed.photo.goodreads.com/books/1657539241i/780581.jpg" alt="Bel Ami by Guy de Maupassant" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
          </div>
        </div>

        <!-- Mangas/Comic Books Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Mangas / Comic Books</h2>
          <div class="grid grid-cols-5 gap-4">
            <img src="https://d29xot63vimef3.cloudfront.net/image/berserk/1-1.jpg" alt="Berserk" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://static.dc.com/dc/files/default_images/injustice_gau_vol1_5b04570647ef69.78676676.jpg" alt="Injustice: Gods Among Us" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://d29xot63vimef3.cloudfront.net/image/watchmen/1-1.jpg" alt="Watchmen" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/I/81u3Y4-OVML._SL1500_.jpg" alt="Death Note" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/I/81YNU9w5CYL._SL1500_.jpg" alt="Hunter x Hunter" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://covers3.booksamillion.com/covers/bam/1/42/151/989/1421519895_b.jpg" alt="Real by Takehiko Inoue" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/I/81d9zKrEHaL._SL1500_.jpg" alt="Great Teacher Onizuka" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/I/71V5jqJbZEL._SL1178_.jpg" alt="Beck by Harold Sakuishi" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://covers4.booksamillion.com/covers/bam/1/50/670/774/1506707742_b.jpg" alt="Gantz" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://m.media-amazon.com/images/I/91tB-gLGqvL._SL1500_.jpg" alt="The Life and Times of Scrooge McDuck by Don Rosa" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
          </div>
        </div>

        <!-- Music Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Music</h2>
          <div class="grid grid-cols-5 gap-4">
            <img src="https://i.scdn.co/image/ab67616d00001e02c383eff4368b19f5f05b3108" alt="California by Mr Bungle" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e02e721e0f37e8b68203a2a3480" alt="The Seer by Swans" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e0236c5417732e53e23cb219246" alt="MTV Unplugged by Nirvana" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e02db216ca805faf5fe35df4ee6" alt="The Dark Side of the Moon by Pink Floyd" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e0286a643caf15e2d5ae1eb09a3" alt="Infinity by Devin Townsend" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://f4.bcbits.com/img/a3240105575_10.jpg" alt="Veteran by JPEGMAFIA" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e0228b55b7357517954b4d91f3d" alt="Insurgentes by Steven Wilson" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e022fcb0a3c7a66e516b11cd26e" alt="Mezzanine by Massive Attack" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e02e00d963c3eb8b930d8e32d5f" alt="La Fin de l'Espèce by Klub des Loosers" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://i.scdn.co/image/ab67616d00001e02897cd4eeff3174110aa6230b" alt="The Social Network by Trent Reznor & Atticus Ross" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
          </div>
        </div>

        <!-- Movies Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">Movies</h2>
          <div class="grid grid-cols-5 gap-4">
            <img src="https://image.tmdb.org/t/p/original/7fn624j5lj3xTme2SgiLCeuedmO.jpg" alt="Whiplash" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/wby9315QzVKdW9BonAefg8jGTTb.jpg" alt="American Beauty" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/8yj6tkyp7dvdzkkIasX2SUmZd81.jpg" alt="99 Francs" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/6jmppcaubzLF8wkXM36ganVISCo.jpg" alt="Soul" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/k6IvmVvfsoIL8HNVusb4oAQr6Rk.jpg" alt="Wrong" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/kc8jT1MAiKM0iwdjAwC5lQrTNry.jpg" alt="Grave" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/rHUg2AuIuLSIYMYFgavVwqt1jtc.jpg" alt="Birdman" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/w500/t5v2Zsb3P0C5c9nCZc4eNkPLcyZ.jpg" alt="Mr Fantastic" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/9tyPnyEkL44qbAliM9jMRWc6bjg.jpg" alt="Spring Breakers" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://image.tmdb.org/t/p/original/gFX7NuBUeKysOB9nEzRqVpHNT32.jpg" alt="Battle Royale" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
          </div>
        </div>

        <!-- TV Shows Section -->
        <div class="mb-16">
          <h2 class="text-2xl font-semibold mb-8" style="color: var(--color-text);">TV Shows</h2>
          <div class="grid grid-cols-5 gap-4">
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/ri8xr223xBb2TeHX3GKypvQPV2B.jpg" alt="The Leftovers" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/AtKo2gANo2QBgZN9ebTAa8hXnvv.jpg" alt="Halt and Catch Fire" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/ddCxr3JOEh8tTebrHlXv31wY37r.jpg" alt="Bref" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/snOU6W5CU7aGVSVu29wBWzdzNzi.jpg" alt="Utopia" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/v2vn1coUMPKw0GI1KGC5J4IXtqp.jpg" alt="Avatar: The Last Airbender" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/pH3u38DXGoeGUU86ZwJrFGBEPiQ.jpg" alt="The Young Pope" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w94_and_h141_face/z7ubox5cI4KGkiHOxBrA20upDaU.jpg" alt="Marble Hornets" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/hMbVY6f4zfUcX0xf2jo3xZFdrMp.jpg" alt="American Vandal" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/mIevNYxovnH4sR22qkUmAgS5vdv.jpg" alt="The Rehearsal" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
            <img src="https://media.themoviedb.org/t/p/w300_and_h450_face/fodyzO7msj5M7f8JdkGGdnL9OxU.jpg" alt="The Mysterious Cities of Gold" class="w-full h-auto rounded shadow-md hover:scale-105 transition-transform" loading="lazy" />
          </div>
        </div>

      </div>
    </section>
  </div>
</PageLayout>
